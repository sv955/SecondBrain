<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Create Todo - Second Brain</title>
    <link rel="icon" type="image/x-icon" href="{{ url_for('static', filename='fav.ico') }}">
    <link href="https://cdn.quilljs.com/1.3.6/quill.snow.css" rel="stylesheet">
    <link rel="stylesheet" href="{{ url_for('static', filename='style.css') }}">
</head>
<body>
    <header class="app-bar">
        <a href="{{ url_for('dashboard') }}" class="app-bar-link">
            <span class="logo">üß†</span>
            <span class="app-name">Second Brain</span>
        </a>
        <nav class="app-nav">
            <a href="{{ url_for('dashboard') }}" class="nav-link">üè† Dashboard</a>
            <a href="{{ url_for('todays_tasks') }}" class="nav-link">üìÖ Today's Tasks</a>
            <a href="{{ url_for('create_todo') }}" class="nav-link active">‚ûï Create Todo</a>
            <a href="{{ url_for('all_todos') }}" class="nav-link">üìã All Todos</a>
            <a href="{{ url_for('create_experience') }}" class="nav-link">üí° Past Experience</a>
            <a href="{{ url_for('view_experiences') }}" class="nav-link">üìö All Experiences</a>
        </nav>
    </header>

    <div class="full-screen-container">
        <main>
            <div class="form-container">
                <h2>Create New Todo</h2>
                
                <form method="POST" action="{{ url_for('create_todo') }}">
                    <div class="form-row-split">
                        <div class="form-group form-group-wide">
                            <label for="title">
                                Title *
                                <span class="char-counter" id="titleCounter">0/200</span>
                            </label>
                            <input type="text" id="title" name="title" required placeholder="Enter todo title" maxlength="200">
                        </div>

                        <div class="form-group-inline">
                            <div class="form-group">
                                <label for="status">Status</label>
                                <select id="status" name="status">
                                    <option value="in-queue">In Queue</option>
                                    <option value="ready">Ready</option>
                                    <option value="in-progress">In Progress</option>
                                    <option value="hold">Hold</option>
                                    <option value="done">Done</option>
                                </select>
                            </div>

                            <div class="form-group">
                                <label for="priority">Priority</label>
                                <select id="priority" name="priority">
                                    <option value="Low">Low</option>
                                    <option value="Medium" selected>Medium</option>
                                    <option value="High">High</option>
                                    <option value="Critical">Critical</option>
                                </select>
                            </div>

                            <div class="form-group">
                                <label for="target_date">Target Date</label>
                                <input type="date" id="target_date" name="target_date">
                                <div class="date-quick-select">
                                    <button type="button" class="date-btn" onclick="setTargetDaysFromNow(7)">+7 days</button>
                                    <button type="button" class="date-btn" onclick="setTargetDaysFromNow(15)">+15 days</button>
                                    <button type="button" class="date-btn" onclick="setTargetDaysFromNow(30)">+30 days</button>
                                </div>
                            </div>
                        </div>
                    </div>

                    <div class="form-row-split">
                        <div class="form-group">
                            <label for="start_date">Work Start Date</label>
                            <input type="date" id="start_date" name="start_date">
                            <div class="date-quick-select">
                                <button type="button" class="date-btn" onclick="setStartToday()">Today</button>
                                <button type="button" class="date-btn" onclick="setStartDaysFromNow(3)">+3 days</button>
                                <button type="button" class="date-btn" onclick="setStartDaysFromNow(7)">+7 days</button>
                            </div>
                        </div>

                        <div class="form-group">
                            <label for="end_date">Work End Date</label>
                            <input type="date" id="end_date" name="end_date">
                            <div class="date-quick-select">
                                <button type="button" class="date-btn" onclick="setEndDaysFromNow(7)">+7 days</button>
                                <button type="button" class="date-btn" onclick="setEndDaysFromNow(15)">+15 days</button>
                                <button type="button" class="date-btn" onclick="setEndDaysFromNow(30)">+30 days</button>
                            </div>
                        </div>
                    </div>

                    <div class="form-group">
                        <label for="description">
                            Description
                            <span class="char-counter" id="descriptionCounter">0/10000</span>
                        </label>
                        <div id="editor" style="height: 400px;"></div>
                        <input type="hidden" id="description" name="description">
                    </div>

                    <div class="form-actions">
                        <button type="submit" class="btn btn-primary">Create Todo</button>
                        <a href="{{ url_for('dashboard') }}" class="btn btn-secondary">Cancel</a>
                    </div>
                </form>
            </div>
        </main>
    </div>
    <script src="https://cdn.quilljs.com/1.3.6/quill.js"></script>
    <script>
        // Set up date constraints
        const today = new Date();
        const todayStr = today.toISOString().split('T')[0];
        const maxDate = new Date();
        maxDate.setFullYear(today.getFullYear() + 10);
        const maxDateStr = maxDate.toISOString().split('T')[0];
        
        const targetDateInput = document.getElementById('target_date');
        const startDateInput = document.getElementById('start_date');
        const endDateInput = document.getElementById('end_date');
        
        targetDateInput.value = todayStr;
        targetDateInput.min = todayStr;
        targetDateInput.max = maxDateStr;
        
        startDateInput.min = todayStr;
        startDateInput.max = maxDateStr;
        
        endDateInput.min = todayStr;
        endDateInput.max = maxDateStr;

        // Title character counter
        const titleInput = document.getElementById('title');
        const titleCounter = document.getElementById('titleCounter');
        titleInput.addEventListener('input', function() {
            const length = this.value.length;
            titleCounter.textContent = length + '/200';
        });

        // Quick date selection functions for target date
        function setTargetDaysFromNow(days) {
            const date = new Date();
            date.setDate(date.getDate() + days);
            const dateStr = date.toISOString().split('T')[0];
            targetDateInput.value = dateStr;
        }

        // Quick date selection functions for start date
        function setStartToday() {
            startDateInput.value = todayStr;
        }

        function setStartDaysFromNow(days) {
            const date = new Date();
            date.setDate(date.getDate() + days);
            const dateStr = date.toISOString().split('T')[0];
            startDateInput.value = dateStr;
        }

        // Quick date selection functions for end date
        function setEndDaysFromNow(days) {
            const date = new Date();
            date.setDate(date.getDate() + days);
            const dateStr = date.toISOString().split('T')[0];
            endDateInput.value = dateStr;
        }

        var quill = new Quill('#editor', {
            theme: 'snow',
            modules: {
                toolbar: [
                    [{ 'header': [1, 2, 3, false] }],
                    ['bold', 'italic', 'underline', 'strike'],
                    [{ 'color': [] }, { 'background': [] }],
                    [{ 'align': [] }],
                    [{ 'list': 'ordered'}, { 'list': 'bullet' }],
                    ['blockquote', 'code-block'],
                    ['link', 'image'],
                    ['clean']
                ]
            },
            placeholder: 'Enter todo description (optional)...'
        });

        // Add orange border on Quill editor focus
        quill.on('selection-change', function(range, oldRange, source) {
            const container = document.querySelector('.ql-container');
            const toolbar = document.querySelector('.ql-toolbar');
            if (range) {
                // Editor has focus
                container.style.borderColor = '#ff8800';
                container.style.boxShadow = '0 0 0 2px rgba(255, 136, 0, 0.1)';
                toolbar.style.borderColor = '#ff8800';
            } else {
                // Editor lost focus
                container.style.borderColor = '#000000';
                container.style.boxShadow = 'none';
                toolbar.style.borderColor = '#000000';
            }
        });

        // Description character counter
        const descriptionCounter = document.getElementById('descriptionCounter');
        const MAX_DESC_LENGTH = 10000;
        
        quill.on('text-change', function() {
            const text = quill.getText();
            const length = text.trim().length;
            descriptionCounter.textContent = length + '/10000';
            
            // Prevent typing if limit exceeded
            if (length > MAX_DESC_LENGTH) {
                quill.deleteText(MAX_DESC_LENGTH, length);
            }
        });

        // Handle form submission
        document.querySelector('form').onsubmit = function(e) {
            var description = document.querySelector('input[name=description]');
            description.value = quill.root.innerHTML;
            
            // Validate work dates
            const today = new Date();
            today.setHours(0, 0, 0, 0);
            
            const startDate = startDateInput.value ? new Date(startDateInput.value) : null;
            const endDate = endDateInput.value ? new Date(endDateInput.value) : null;
            const targetDate = targetDateInput.value ? new Date(targetDateInput.value) : null;
            
            // Check if work start date is before today
            if (startDate && startDate < today) {
                alert('Work Start Date cannot be before today.');
                e.preventDefault();
                return false;
            }
            
            // Check if work end date is before today
            if (endDate && endDate < today) {
                alert('Work End Date cannot be before today.');
                e.preventDefault();
                return false;
            }
            
            // Check if work start date is after target date
            if (startDate && targetDate && startDate > targetDate) {
                alert('Work Start Date cannot be after Target Date.');
                e.preventDefault();
                return false;
            }
            
            // Check if work end date is after target date
            if (endDate && targetDate && endDate > targetDate) {
                alert('Work End Date cannot be after Target Date.');
                e.preventDefault();
                return false;
            }
            
            // Check if work end date is before work start date
            if (startDate && endDate && endDate < startDate) {
                alert('Work End Date cannot be before Work Start Date.');
                e.preventDefault();
                return false;
            }
            
            return true;
        };
    </script>
</body>
</html>
