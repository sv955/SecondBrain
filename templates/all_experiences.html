<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>All Experiences - Second Brain</title>
    <link rel="icon" type="image/x-icon" href="{{ url_for('static', filename='fav.ico') }}">
    <link rel="stylesheet" href="{{ url_for('static', filename='style.css') }}">
</head>
<body>
    <header class="app-bar">
        <a href="{{ url_for('dashboard') }}" class="app-bar-link">
            <span class="logo">üß†</span>
            <span class="app-name">Second Brain</span>
        </a>
        <nav class="app-nav">
            <a href="{{ url_for('dashboard') }}" class="nav-link">üè† Dashboard</a>
            <a href="{{ url_for('todays_tasks') }}" class="nav-link">üìÖ Today's Tasks</a>
            <a href="{{ url_for('create_todo') }}" class="nav-link">‚ûï Create Todo</a>
            <a href="{{ url_for('all_todos') }}" class="nav-link">üìã All Todos</a>
            <a href="{{ url_for('create_experience') }}" class="nav-link">üí° Past Experience</a>
            <a href="{{ url_for('view_experiences') }}" class="nav-link active">üìö All Experiences</a>
        </nav>
    </header>

    <div class="full-screen-container">
        <main class="todos-main">
            <div class="todos-toolbar">
                <h2>All Experiences</h2>
                <div class="toolbar-actions">
                    <div class="filter-group">
                        <label>From Date:</label>
                        <input type="date" id="fromDate" value="{{ from_date or '' }}" onchange="applyFilters()">
                    </div>
                    <div class="filter-group">
                        <label>To Date:</label>
                        <input type="date" id="toDate" value="{{ to_date or '' }}" onchange="applyFilters()">
                    </div>
                    <div class="filter-group">
                        <label>Sort by:</label>
                        <select id="sortBy" onchange="applyFilters()">
                            <option value="created_at" {% if current_sort == 'created_at' %}selected{% endif %}>Created Date</option>
                            <option value="updated_at" {% if current_sort == 'updated_at' %}selected{% endif %}>Updated Date</option>
                            <option value="title" {% if current_sort == 'title' %}selected{% endif %}>Title</option>
                        </select>
                    </div>
                    <div class="filter-group">
                        <label>Order:</label>
                        <select id="sortOrder" onchange="applyFilters()">
                            <option value="DESC" {% if current_order == 'DESC' %}selected{% endif %}>Descending</option>
                            <option value="ASC" {% if current_order == 'ASC' %}selected{% endif %}>Ascending</option>
                        </select>
                    </div>
                    <a href="{{ url_for('create_experience') }}" class="btn btn-primary">+ New Experience</a>
                </div>
            </div>

            {% if experiences %}
                <div class="todos-table">
                    <table>
                        <thead>
                            <tr>
                                <th style="width: 60px;">S.No</th>
                                <th class="sortable" onclick="sortBy('title')" style="min-width: 300px;">
                                    Title
                                    <span class="sort-arrow">{{ '‚Üë' if current_sort == 'title' and current_order == 'ASC' else '‚Üì' if current_sort == 'title' else '‚Üï' }}</span>
                                </th>
                                <th class="sortable" onclick="sortBy('created_at')" style="width: 150px;">
                                    Created
                                    <span class="sort-arrow">{{ '‚Üë' if current_sort == 'created_at' and current_order == 'ASC' else '‚Üì' if current_sort == 'created_at' else '‚Üï' }}</span>
                                </th>
                                <th class="sortable" onclick="sortBy('updated_at')" style="width: 150px;">
                                    Updated
                                    <span class="sort-arrow">{{ '‚Üë' if current_sort == 'updated_at' and current_order == 'ASC' else '‚Üì' if current_sort == 'updated_at' else '‚Üï' }}</span>
                                </th>
                                <th style="width: 120px;">Actions</th>
                            </tr>
                        </thead>
                        <tbody>
                            {% for experience in experiences %}
                            <tr class="todo-row" onclick="window.location.href='{{ url_for('view_experience', id=experience['id']) }}'">
                                <td>{{ loop.index }}</td>
                                <td class="todo-title">{{ experience['title'] }}</td>
                                <td class="todo-date">{{ experience['created_at'] }}</td>
                                <td class="todo-date">{{ experience['updated_at'] }}</td>
                                <td class="todo-actions" onclick="event.stopPropagation()">
                                    <a href="{{ url_for('view_experience', id=experience['id']) }}" 
                                       class="btn-icon btn-view" 
                                       title="View">üëÅÔ∏è</a>
                                    <a href="{{ url_for('edit_experience', id=experience['id']) }}" 
                                       class="btn-icon btn-edit" 
                                       title="Edit">‚úèÔ∏è</a>
                                    <a href="{{ url_for('delete_experience', id=experience['id']) }}" 
                                       class="btn-icon btn-delete" 
                                       title="Delete" 
                                       onclick="return confirm('Are you sure you want to delete this experience?')">üóë</a>
                                </td>
                            </tr>
                            {% endfor %}
                        </tbody>
                    </table>
                </div>
            {% else %}
                <div class="empty-state">
                    <p>No experiences found. Create your first one!</p>
                    <a href="{{ url_for('create_experience') }}" class="btn btn-primary">Create Experience</a>
                </div>
            {% endif %}
        </main>
    </div>

    <script>
        function formatDate(dateStr) {
            if (!dateStr) return '';
            const date = new Date(dateStr);
            const day = String(date.getDate()).padStart(2, '0');
            const month = String(date.getMonth() + 1).padStart(2, '0');
            const year = date.getFullYear();
            return `${day}/${month}/${year}`;
        }

        function formatDateTime(dateStr) {
            if (!dateStr) return '';
            const date = new Date(dateStr);
            const day = String(date.getDate()).padStart(2, '0');
            const month = String(date.getMonth() + 1).padStart(2, '0');
            const year = date.getFullYear();
            const hours = String(date.getHours()).padStart(2, '0');
            const minutes = String(date.getMinutes()).padStart(2, '0');
            return `${day}/${month}/${year} ${hours}:${minutes}`;
        }

        function sortBy(column) {
            const currentSort = '{{ current_sort }}';
            const currentOrder = '{{ current_order }}';
            
            let newOrder = 'DESC';
            if (currentSort === column) {
                newOrder = currentOrder === 'DESC' ? 'ASC' : 'DESC';
            }
            
            const fromDate = document.getElementById('fromDate').value;
            const toDate = document.getElementById('toDate').value;
            
            let url = '{{ url_for("view_experiences") }}?';
            if (fromDate) url += 'from_date=' + fromDate + '&';
            if (toDate) url += 'to_date=' + toDate + '&';
            url += 'sort=' + column + '&order=' + newOrder;
            
            window.location.href = url;
        }

        function applyFilters() {
            const fromDate = document.getElementById('fromDate').value;
            const toDate = document.getElementById('toDate').value;
            const currentSort = '{{ current_sort or "created_at" }}';
            const currentOrder = '{{ current_order or "DESC" }}';
            
            let url = '{{ url_for("view_experiences") }}?';
            if (fromDate) url += 'from_date=' + fromDate + '&';
            if (toDate) url += 'to_date=' + toDate + '&';
            url += 'sort=' + currentSort + '&order=' + currentOrder;
            
            window.location.href = url;
        }

        // Format all dates on page load
        document.addEventListener('DOMContentLoaded', function() {
            document.querySelectorAll('.todo-date').forEach(function(cell) {
                const dateText = cell.textContent.trim();
                if (dateText) {
                    const formatted = formatDateTime(dateText);
                    if (formatted) cell.textContent = formatted;
                }
            });
        });
    </script>
</body>
</html>
