<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>{{ todo['title'] }} - Second Brain</title>
    <link rel="icon" type="image/x-icon" href="{{ url_for('static', filename='fav.ico') }}">
    <link rel="stylesheet" href="{{ url_for('static', filename='style.css') }}">
</head>
<body>
    <header class="app-bar">
        <a href="{{ url_for('dashboard') }}" class="app-bar-link">
            <span class="logo">üß†</span>
            <span class="app-name">Second Brain</span>
        </a>
        <nav class="app-nav">
            <a href="{{ url_for('dashboard') }}" class="nav-link">üè† Dashboard</a>
            <a href="{{ url_for('create_todo') }}" class="nav-link">‚ûï Create Todo</a>
            <a href="{{ url_for('all_todos') }}" class="nav-link active">üìã All Todos</a>
            <a href="{{ url_for('create_experience') }}" class="nav-link">üí° Past Experience</a>
            <a href="{{ url_for('view_experiences') }}" class="nav-link">üìö All Experiences</a>
        </nav>
    </header>

    <div class="full-screen-container">
        <nav class="breadcrumb">
            <a href="{{ url_for('dashboard') }}">Dashboard</a> / 
            <a href="{{ url_for('all_todos') }}">All Todos</a> / 
            <span>{{ todo['title'] }}</span>
        </nav>

        <main class="todo-detail-main">
            <div class="detail-header">
                <h2>{{ todo['title'] }}</h2>
                <div class="detail-actions">
                    <select class="status-dropdown-large status-{{ todo['status'] }}" 
                            onchange="updateStatus({{ todo['id'] }}, this.value)">
                        <option value="in-queue" {% if todo['status'] == 'in-queue' %}selected{% endif %}>In Queue</option>
                        <option value="ready" {% if todo['status'] == 'ready' %}selected{% endif %}>Ready</option>
                        <option value="in-progress" {% if todo['status'] == 'in-progress' %}selected{% endif %}>In Progress</option>
                        <option value="hold" {% if todo['status'] == 'hold' %}selected{% endif %}>Hold</option>
                        <option value="done" {% if todo['status'] == 'done' %}selected{% endif %}>Done</option>
                    </select>
                    <a href="{{ url_for('all_todos') }}" class="btn btn-secondary">‚Üê Back</a>
                    <a href="{{ url_for('delete_todo', id=todo['id']) }}" 
                       class="btn btn-danger" 
                       onclick="return confirm('Are you sure you want to delete this todo?')">Delete</a>
                </div>
            </div>

            <div class="detail-meta">
                <div class="meta-item">
                    <strong>Priority:</strong> <span class="priority-badge priority-{{ todo['priority'] }}">{{ todo['priority'] }}</span>
                </div>
                <div class="meta-item">
                    <strong>Target Date:</strong> 
                    {% if todo['target_date'] %}
                        {{ todo['target_date'] }}
                    {% else %}
                        <span style="color: #9ca3af;">Not set</span>
                    {% endif %}
                </div>
                <div class="meta-item">
                    <strong>Created:</strong> {{ todo['created_at'] }}
                </div>
                <div class="meta-item">
                    <strong>Last Updated:</strong> {{ todo['updated_at'] }}
                </div>
            </div>

            {% if todo['description'] %}
            <div class="detail-description">
                <h3>Description</h3>
                <div class="description-content">
                    {{ todo['description']|safe }}
                </div>
            </div>
            {% else %}
            <div class="empty-description">
                <p>No description provided</p>
            </div>
            {% endif %}
        </main>
    </div>

    <script>
        function formatDate(dateStr) {
            if (!dateStr) return '';
            const date = new Date(dateStr);
            const day = String(date.getDate()).padStart(2, '0');
            const month = String(date.getMonth() + 1).padStart(2, '0');
            const year = date.getFullYear();
            return `${day}/${month}/${year}`;
        }

        function formatDateTime(dateStr) {
            if (!dateStr) return '';
            const date = new Date(dateStr);
            const day = String(date.getDate()).padStart(2, '0');
            const month = String(date.getMonth() + 1).padStart(2, '0');
            const year = date.getFullYear();
            const hours = String(date.getHours()).padStart(2, '0');
            const minutes = String(date.getMinutes()).padStart(2, '0');
            return `${day}/${month}/${year} ${hours}:${minutes}`;
        }

        function updateStatus(id, status) {
            window.location.href = '{{ url_for("update_status", id=0, status="") }}'.replace('/0/', '/' + id + '/').replace(/\/[^/]*$/, '/' + status);
        }

        // Format dates on page load
        document.addEventListener('DOMContentLoaded', function() {
            const metaItems = document.querySelectorAll('.meta-item');
            metaItems.forEach(function(item) {
                const text = item.textContent;
                if (text.includes('Target Date:')) {
                    const dateSpan = item.querySelector('span:not(.priority-badge)');
                    if (dateSpan && dateSpan.textContent.trim() !== 'Not set') {
                        const parts = item.innerHTML.split('Target Date:</strong>');
                        if (parts[1]) {
                            const dateText = parts[1].trim();
                            if (dateText && !dateText.includes('Not set')) {
                                const formatted = formatDate(dateText);
                                if (formatted) item.innerHTML = parts[0] + 'Target Date:</strong> ' + formatted;
                            }
                        }
                    }
                } else if (text.includes('Created:')) {
                    const dateText = text.split('Created:')[1].trim();
                    const formatted = formatDateTime(dateText);
                    if (formatted) item.innerHTML = '<strong>Created:</strong> ' + formatted;
                } else if (text.includes('Last Updated:')) {
                    const dateText = text.split('Last Updated:')[1].trim();
                    const formatted = formatDateTime(dateText);
                    if (formatted) item.innerHTML = '<strong>Last Updated:</strong> ' + formatted;
                }
            });
        });
    </script>
</body>
</html>
